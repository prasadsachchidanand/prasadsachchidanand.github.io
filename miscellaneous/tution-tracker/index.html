<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuition Charge Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        h1, h2 {
            color: #2c3e50;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        input, select {
            padding: 8px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 15px;
        }
        input[type="checkbox"] {
            width: auto;
            margin-bottom: 0;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .action-buttons {
            width: 120px;
        }
        .summary-card {
            background-color: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 10px;
            margin-bottom: 15px;
        }
        .add-form {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .form-row {
            display: flex;
            margin-bottom: 10px;
            gap: 10px;
        }
        .form-group {
            flex: 1;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .delete-btn {
            background-color: #f44336;
        }
        .delete-btn:hover {
            background-color: #d32f2f;
        }
        .login-form input {
            margin-bottom: 15px;
        }
        .login-button {
            width: 100%;
        }
        .error-message {
            color: #f44336;
            margin-bottom: 15px;
        }
        .settings-btn {
            background-color: #2196F3;
            position: absolute;
            top: 20px;
            right: 20px;
        }
        .settings-btn:hover {
            background-color: #0b7dda;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: black;
        }
        .export-import-btn {
            background-color: #ff9800;
        }
        .export-import-btn:hover {
            background-color: #e68a00;
        }
        .logout-btn {
            background-color: #607d8b;
            margin-top: 20px;
        }
        .logout-btn:hover {
            background-color: #546e7a;
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <h2>Tuition Charge Tracker</h2>
        <p>Please enter your password to access the application</p>
        <div id="loginError" class="error-message"></div>
        <div class="login-form">
            <input type="password" id="passwordInput" placeholder="Enter password">
            <button class="login-button" onclick="login()">Login</button>
        </div>
    </div>

    <div id="appContainer" class="container" style="display: none;">
        <h1>Tuition Charge Tracker</h1>
        <button id="settingsBtn" class="settings-btn" onclick="openSettings()">Settings</button>
        
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeSettings()">&times;</span>
                <h2>Settings</h2>
                
                <h3>Change Password</h3>
                <input type="password" id="currentPassword" placeholder="Current Password">
                <input type="password" id="newPassword" placeholder="New Password">
                <input type="password" id="confirmPassword" placeholder="Confirm New Password">
                <button onclick="changePassword()">Update Password</button>
                
                <h3>Data Management</h3>
                <button class="export-import-btn" onclick="exportData()">Export Data</button>
                <button class="export-import-btn" onclick="document.getElementById('importFile').click()">Import Data</button>
                <input type="file" id="importFile" style="display: none;" onchange="importData(event)">
                
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('sessions')">Sessions</div>
            <div class="tab" onclick="showTab('summary')">Summary</div>
            <div class="tab" onclick="showTab('students')">Manage Students</div>
        </div>
        
        <div id="sessions" class="tab-content active">
            <h2>Tutoring Sessions</h2>
            
            <div class="add-form">
                <h3>Add New Session</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="sessionStudent">Student</label>
                        <select id="sessionStudent">
                            <option value="">Select Student</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sessionDate">Date</label>
                        <input type="date" id="sessionDate">
                    </div>
                    <div class="form-group">
                        <label for="sessionDuration">Duration (hours)</label>
                        <input type="number" id="sessionDuration" min="0.5" step="0.5" value="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="sessionCompleted">
                            <input type="checkbox" id="sessionCompleted" checked>
                            Completed
                        </label>
                    </div>
                    <div class="form-group" style="text-align: right;">
                        <button onclick="addSession()">Add Session</button>
                    </div>
                </div>
            </div>
            
            <table id="sessionsTable">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Date</th>
                        <th>Duration (hours)</th>
                        <th>Rate (GBP)</th>
                        <th>Completed</th>
                        <th>Amount (GBP)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="sessionsBody">
                    <!-- Sessions will be added here -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="5" style="text-align: right;"><strong>Total:</strong></td>
                        <td id="totalAmount"><strong>0.00</strong></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div id="summary" class="tab-content">
            <h2>Student Summary</h2>
            <div id="summaryCards">
                <!-- Summary cards will be added here -->
            </div>
            
            <table id="summaryTable">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Hourly Rate (GBP)</th>
                        <th>Total Hours</th>
                        <th>Total Earnings (GBP)</th>
                    </tr>
                </thead>
                <tbody id="summaryBody">
                    <!-- Summary rows will be added here -->
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="2" style="text-align: right;"><strong>Totals:</strong></td>
                        <td id="totalHours"><strong>0</strong></td>
                        <td id="totalEarnings"><strong>0.00</strong></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div id="students" class="tab-content">
            <h2>Manage Students</h2>
            
            <div class="add-form">
                <h3>Add New Student</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="studentName">Student Name</label>
                        <input type="text" id="studentName" placeholder="Enter student name">
                    </div>
                    <div class="form-group">
                        <label for="hourlyRate">Hourly Rate (GBP)</label>
                        <input type="number" id="hourlyRate" min="1" step="0.5" value="25">
                    </div>
                    <div class="form-group" style="align-self: flex-end;">
                        <button onclick="addStudent()">Add Student</button>
                    </div>
                </div>
            </div>
            
            <table id="studentsTable">
                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Hourly Rate (GBP)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="studentsBody">
                    <!-- Students will be added here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Data storage
        let students = [
            { id: 1, name: 'Student1', rate: 20 },
            { id: 2, name: 'Student2', rate: 25 },
            { id: 3, name: 'Student3', rate: 25 }
        ];
        
        let sessions = [];
        let nextStudentId = 4;
        let nextSessionId = 1;
        
        // Password management
        const DEFAULT_PASSWORD = "tutor123"; // Default password
        let currentPassword = DEFAULT_PASSWORD;
        let isLoggedIn = false;
        
        // Check if user has set a password
        function initializePassword() {
            const savedPassword = localStorage.getItem('tutoring_password');
            if (savedPassword) {
                currentPassword = savedPassword;
            } else {
                localStorage.setItem('tutoring_password', currentPassword);
            }
        }
        
        // Login function
        function login() {
            const enteredPassword = document.getElementById('passwordInput').value;
            
            if (enteredPassword === currentPassword) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('loginError').textContent = '';
                isLoggedIn = true;
                loadData();
            } else {
                document.getElementById('loginError').textContent = 'Incorrect password. Please try again.';
            }
        }
        
        // Logout function
        function logout() {
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('appContainer').style.display = 'none';
            isLoggedIn = false;
            closeSettings();
        }
        
        // Change password
        function changePassword() {
            const currentPasswordInput = document.getElementById('currentPassword').value;
            const newPasswordInput = document.getElementById('newPassword').value;
            const confirmPasswordInput = document.getElementById('confirmPassword').value;
            
            if (currentPasswordInput !== currentPassword) {
                alert('Current password is incorrect');
                return;
            }
            
            if (newPasswordInput === '') {
                alert('New password cannot be empty');
                return;
            }
            
            if (newPasswordInput !== confirmPasswordInput) {
                alert('New passwords do not match');
                return;
            }
            
            currentPassword = newPasswordInput;
            localStorage.setItem('tutoring_password', currentPassword);
            
            // Clear fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            alert('Password updated successfully');
            closeSettings();
        }
        
        // Settings modal functions
        function openSettings() {
            document.getElementById('settingsModal').style.display = 'block';
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }
        
        // Export data
        function exportData() {
            const data = {
                students: students,
                sessions: sessions,
                nextStudentId: nextStudentId,
                nextSessionId: nextSessionId
            };
            
            const dataStr = JSON.stringify(data);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'tuition_data.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // Import data
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.students && data.sessions && data.nextStudentId && data.nextSessionId) {
                        students = data.students;
                        sessions = data.sessions;
                        nextStudentId = data.nextStudentId;
                        nextSessionId = data.nextSessionId;
                        
                        saveData();
                        updateStudentDropdown();
                        renderStudents();
                        renderSessions();
                        renderSummary();
                        
                        alert('Data imported successfully');
                    } else {
                        alert('Invalid data format');
                    }
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }
        
        // Check for saved data
        function loadData() {
            const savedStudents = localStorage.getItem('tutoring_students');
            const savedSessions = localStorage.getItem('tutoring_sessions');
            const savedNextStudentId = localStorage.getItem('tutoring_nextStudentId');
            const savedNextSessionId = localStorage.getItem('tutoring_nextSessionId');
            
            if (savedStudents) students = JSON.parse(savedStudents);
            if (savedSessions) sessions = JSON.parse(savedSessions);
            if (savedNextStudentId) nextStudentId = parseInt(savedNextStudentId);
            if (savedNextSessionId) nextSessionId = parseInt(savedNextSessionId);
            
            updateStudentDropdown();
            renderStudents();
            renderSessions();
            renderSummary();
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('tutoring_students', JSON.stringify(students));
            localStorage.setItem('tutoring_sessions', JSON.stringify(sessions));
            localStorage.setItem('tutoring_nextStudentId', nextStudentId);
            localStorage.setItem('tutoring_nextSessionId', nextSessionId);
        }
        
        // Update student dropdown in sessions tab
        function updateStudentDropdown() {
            const dropdown = document.getElementById('sessionStudent');
            dropdown.innerHTML = '<option value="">Select Student</option>';
            
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                dropdown.appendChild(option);
            });
        }
        
        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            
            // Deactivate all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Show the selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Find and activate the tab button
            const tabElements = document.getElementsByClassName('tab');
            for (let i = 0; i < tabElements.length; i++) {
                if (tabElements[i].innerHTML.toLowerCase().includes(tabName)) {
                    tabElements[i].classList.add('active');
                    break;
                }
            }
        }
        
        // Add a new student
        function addStudent() {
            const nameInput = document.getElementById('studentName');
            const rateInput = document.getElementById('hourlyRate');
            
            const name = nameInput.value.trim();
            const rate = parseFloat(rateInput.value);
            
            if (!name) {
                alert('Please enter a student name');
                return;
            }
            
            if (isNaN(rate) || rate <= 0) {
                alert('Please enter a valid hourly rate');
                return;
            }
            
            const newStudent = {
                id: nextStudentId++,
                name: name,
                rate: rate
            };
            
            students.push(newStudent);
            
            // Clear inputs
            nameInput.value = '';
            rateInput.value = '25';
            
            renderStudents();
            updateStudentDropdown();
            saveData();
        }
        
        // Render students table
        function renderStudents() {
            const tbody = document.getElementById('studentsBody');
            tbody.innerHTML = '';
            
            students.forEach(student => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = student.name;
                row.appendChild(nameCell);
                
                const rateCell = document.createElement('td');
                rateCell.textContent = `£${student.rate.toFixed(2)}`;
                row.appendChild(rateCell);
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'action-buttons';
                
                const editBtn = document.createElement('button');
                editBtn.textContent = 'Edit';
                editBtn.onclick = () => editStudent(student.id);
                actionsCell.appendChild(editBtn);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = () => deleteStudent(student.id);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(actionsCell);
                tbody.appendChild(row);
            });
        }
        
        // Edit student
        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;
            
            const newName = prompt('Enter new name for student:', student.name);
            if (!newName || newName.trim() === '') return;
            
            const newRate = prompt('Enter new hourly rate (GBP):', student.rate);
            const parsedRate = parseFloat(newRate);
            
            if (isNaN(parsedRate) || parsedRate <= 0) {
                alert('Please enter a valid hourly rate');
                return;
            }
            
            student.name = newName.trim();
            student.rate = parsedRate;
            
            renderStudents();
            renderSessions();
            renderSummary();
            updateStudentDropdown();
            saveData();
        }
        
        // Delete student
        function deleteStudent(id) {
            if (!confirm('Are you sure you want to delete this student? All associated sessions will be deleted as well.')) {
                return;
            }
            
            students = students.filter(s => s.id !== id);
            sessions = sessions.filter(s => s.studentId !== id);
            
            renderStudents();
            renderSessions();
            renderSummary();
            updateStudentDropdown();
            saveData();
        }
        
        // Add a new session
        function addSession() {
            const studentSelect = document.getElementById('sessionStudent');
            const dateInput = document.getElementById('sessionDate');
            const durationInput = document.getElementById('sessionDuration');
            const completedInput = document.getElementById('sessionCompleted');
            
            const studentId = parseInt(studentSelect.value);
            const date = dateInput.value;
            const duration = parseFloat(durationInput.value);
            const completed = completedInput.checked;
            
            if (!studentId) {
                alert('Please select a student');
                return;
            }
            
            if (!date) {
                alert('Please select a date');
                return;
            }
            
            if (isNaN(duration) || duration <= 0) {
                alert('Please enter a valid duration');
                return;
            }
            
            const student = students.find(s => s.id === studentId);
            if (!student) {
                alert('Selected student not found');
                return;
            }
            
            const newSession = {
                id: nextSessionId++,
                studentId: studentId,
                date: date,
                duration: duration,
                completed: completed,
                amount: completed ? (student.rate * duration) : 0
            };
            
            sessions.push(newSession);
            
            // Set default values
            dateInput.value = '';
            durationInput.value = '1';
            completedInput.checked = true;
            
            renderSessions();
            renderSummary();
            saveData();
        }
        
        // Render sessions table
        function renderSessions() {
            const tbody = document.getElementById('sessionsBody');
            tbody.innerHTML = '';
            
            // Sort sessions by date (newest first)
            const sortedSessions = [...sessions].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
            
            let totalAmount = 0;
            
            sortedSessions.forEach(session => {
                const student = students.find(s => s.id === session.studentId);
                if (!student) return;
                
                const row = document.createElement('tr');
                
                const studentCell = document.createElement('td');
                studentCell.textContent = student.name;
                row.appendChild(studentCell);
                
                const dateCell = document.createElement('td');
                dateCell.textContent = formatDate(session.date);
                row.appendChild(dateCell);
                
                const durationCell = document.createElement('td');
                durationCell.textContent = session.duration;
                row.appendChild(durationCell);
                
                const rateCell = document.createElement('td');
                rateCell.textContent = `£${student.rate.toFixed(2)}`;
                row.appendChild(rateCell);
                
                const completedCell = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = session.completed;
                checkbox.onchange = () => toggleSessionCompletion(session.id, checkbox.checked);
                completedCell.appendChild(checkbox);
                row.appendChild(completedCell);
                
                const amountCell = document.createElement('td');
                const amount = session.completed ? (student.rate * session.duration) : 0;
                amountCell.textContent = `£${amount.toFixed(2)}`;
                row.appendChild(amountCell);
                
                totalAmount += amount;
                
                const actionsCell = document.createElement('td');
                actionsCell.className = 'action-buttons';
                
                const editBtn = document.createElement('button');
                editBtn.textContent = 'Edit';
                editBtn.onclick = () => editSession(session.id);
                actionsCell.appendChild(editBtn);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.className = 'delete-btn';
                deleteBtn.onclick = () => deleteSession(session.id);
                actionsCell.appendChild(deleteBtn);
                
                row.appendChild(actionsCell);
                tbody.appendChild(row);
            });
            
            document.getElementById('totalAmount').textContent = `£${totalAmount.toFixed(2)}`;
        }
        
        // Toggle session completion status
        function toggleSessionCompletion(id, completed) {
            const session = sessions.find(s => s.id === id);
            if (!session) return;
            
            session.completed = completed;
            
            renderSessions();
            renderSummary();
            saveData();
        }
        
        // Edit session
        function editSession(id) {
            const session = sessions.find(s => s.id === id);
            if (!session) return;
            
            const student = students.find(s => s.id === session.studentId);
            if (!student) return;
            
            // Create student options for dropdown
            let studentOptions = '';
            students.forEach(s => {
                const selected = s.id === session.studentId ? 'selected' : '';
                studentOptions += `<option value="${s.id}" ${selected}>${s.name}</option>`;
            });
            
            // Create edit form
            const form = document.createElement('div');
            form.innerHTML = `
                <h3>Edit Session</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editStudent">Student</label>
                        <select id="editStudent">
                            ${studentOptions}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editDate">Date</label>
                        <input type="date" id="editDate" value="${session.date}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editDuration">Duration (hours)</label>
                        <input type="number" id="editDuration" min="0.5" step="0.5" value="${session.duration}">
                    </div>
                    <div class="form-group">
                        <label for="editCompleted">
                            <input type="checkbox" id="editCompleted" ${session.completed ? 'checked' : ''}>
                            Completed
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <button id="saveEdit">Save Changes</button>
                        <button id="cancelEdit">Cancel</button>
                    </div>
                </div>
            `;
            
            // Show dialog
            const sessionsTab = document.getElementById('sessions');
            const oldForm = document.querySelector('.edit-form');
            if (oldForm) oldForm.remove();
            
            form.className = 'add-form edit-form';
            sessionsTab.insertBefore(form, document.querySelector('#sessions table'));
            
            // Add event listeners
            document.getElementById('saveEdit').addEventListener('click', () => {
                const studentId = parseInt(document.getElementById('editStudent').value);
                const date = document.getElementById('editDate').value;
                const duration = parseFloat(document.getElementById('editDuration').value);
                const completed = document.getElementById('editCompleted').checked;
                
                if (!studentId || !date || isNaN(duration) || duration <= 0) {
                    alert('Please fill in all fields correctly');
                    return;
                }
                
                // Update session
                session.studentId = studentId;
                session.date = date;
                session.duration = duration;
                session.completed = completed;
                
                form.remove();
                renderSessions();
                renderSummary();
                saveData();
            });
            
            document.getElementById('cancelEdit').addEventListener('click', () => {
                form.remove();
            });
        }
        
        // Delete session
        function deleteSession(id) {
            if (!confirm('Are you sure you want to delete this session?')) {
                return;
            }
            
            sessions = sessions.filter(s => s.id !== id);
            
            renderSessions();
            renderSummary();
            saveData();
        }
        
        // Render summary view
        function renderSummary() {
            const tbody = document.getElementById('summaryBody');
            const summaryCards = document.getElementById('summaryCards');
            
            tbody.innerHTML = '';
            summaryCards.innerHTML = '';
            
            let totalHours = 0;
            let totalEarnings = 0;
            
            // Create summary by student
            students.forEach(student => {
                const studentSessions = sessions.filter(s => s.studentId === student.id && s.completed);
                
                const totalStudentHours = studentSessions.reduce((sum, session) => sum + session.duration, 0);
                const totalStudentEarnings = studentSessions.reduce((sum, session) => sum + (student.rate * session.duration), 0);
                
                totalHours += totalStudentHours;
                totalEarnings += totalStudentEarnings;
                
                // Add to summary table
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = student.name;
                row.appendChild(nameCell);
                
                const rateCell = document.createElement('td');
                rateCell.textContent = `£${student.rate.toFixed(2)}`;
                row.appendChild(rateCell);
                
                const hoursCell = document.createElement('td');
                hoursCell.textContent = totalStudentHours.toFixed(1);
                row.appendChild(hoursCell);
                
                const earningsCell = document.createElement('td');
                earningsCell.textContent = `£${totalStudentEarnings.toFixed(2)}`;
                row.appendChild(earningsCell);
                
                tbody.appendChild(row);
                
                // Create summary card
                const card = document.createElement('div');
                card.className = 'summary-card';
                card.innerHTML = `
                    <h3>${student.name}</h3>
                    <p><strong>Rate:</strong> £${student.rate.toFixed(2)} per hour</p>
                    <p><strong>Total Hours:</strong> ${totalStudentHours.toFixed(1)}</p>
                    <p><strong>Total Earnings:</strong> £${totalStudentEarnings.toFixed(2)}</p>
                `;
                summaryCards.appendChild(card);
            });
            
            // Update totals
            document.getElementById('totalHours').textContent = totalHours.toFixed(1);
            document.getElementById('totalEarnings').textContent = `£${totalEarnings.toFixed(2)}`;
        }
        
        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }
        
        // Set today's date as default
        function setDefaultDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const dateString = `${year}-${month}-${day}`;
            
            document.getElementById('sessionDate').value = dateString;
        }
        
        // Initialize
        window.onload = function() {
            loadData();
            setDefaultDate();
        };
    </script>
</body>
</html>